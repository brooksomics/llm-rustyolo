# Release Notes: v0.6.0 - Gemini CLI Support

## üöÄ New Features

Version 0.6.0 adds support for Google's Gemini CLI, enabling users to run Gemini agents with the same security guarantees as Claude Code.

### Gemini CLI Integration

Run Google Gemini AI assistant inside the rustyolo sandbox with full network isolation, filesystem protection, and syscall filtering.

**Usage:**
```bash
# Start Gemini with API key authentication
rustyolo gemini
```

**Key features:**
- ‚úÖ Gemini CLI v0.17.1 pre-installed in Docker image
- ‚úÖ Automatic domain whitelisting for Gemini API and OAuth
- ‚úÖ Two authentication methods: API key and OAuth
- ‚úÖ Full security layer protection (filesystem, privilege, network, syscall)

### Automatic Domain Whitelisting

Gemini-specific domains are automatically whitelisted when running `rustyolo gemini`:
- `generativelanguage.googleapis.com` - Gemini API endpoint
- `accounts.google.com` - Google OAuth login
- `oauth2.googleapis.com` - OAuth token exchange
- `www.googleapis.com` - General Google APIs

No manual configuration needed - just like Claude's Anthropic domains.

### Two Authentication Methods

**Option 1: API Key (Simplest)**
```bash
rustyolo gemini
# Select "2. Use Gemini API Key"
# Get key at: https://aistudio.google.com/app/apikey
```

**Option 2: Google OAuth (One-time setup)**
```bash
# 1. Install Gemini CLI on your host
brew install gemini-cli  # or: npm install -g @google/gemini-cli

# 2. Authenticate once on your host (browser opens)
gemini  # Select "1. Login with Google"

# 3. Mount OAuth credentials with rustyolo
rustyolo -v ~/.gemini:/home/agent/.gemini gemini
```

OAuth credentials are stored in `~/.gemini/oauth_creds.json` and reused automatically across sessions.

## üìö Documentation

### New Guides

**Gemini Authentication Guide** (`docs/guides/gemini-authentication.md`)
- Comprehensive setup instructions for both auth methods
- Homebrew and npm installation options
- Pre-authentication OAuth workflow
- Troubleshooting common issues
- Persistent authentication setup

**Updated Main README** (`CLAUDE.md`)
- Gemini usage examples
- Quick start for both authentication methods
- Link to detailed authentication guide

### What's Included

- Complete OAuth workflow tested and documented
- Explanation of why `:ro` (read-only) mounts fail with Gemini
- `.rustyolo.toml` configuration examples
- Comparison of API key vs OAuth methods

## üîß Technical Details

### Docker Image Changes

**Dockerfile:** Install `@google/gemini-cli` via npm
```dockerfile
RUN npm install -g @anthropic-ai/claude-code @google/gemini-cli
```

**Image size impact:** ~50MB increase for Gemini CLI and dependencies

### Rust CLI Changes

**New constant** (`src/main.rs:26`):
```rust
const GEMINI_DOMAINS: &str = "generativelanguage.googleapis.com accounts.google.com oauth2.googleapis.com www.googleapis.com";
```

**Auto-whitelisting logic** (`src/main.rs:765-771`):
```rust
if args.agent == "gemini" {
    if trusted_domains.is_empty() {
        trusted_domains = GEMINI_DOMAINS.to_string();
    } else if !trusted_domains.contains("googleapis.com") {
        trusted_domains = format!("{trusted_domains} {GEMINI_DOMAINS}");
    }
}
```

### OAuth Technical Requirements

Gemini CLI requires **write access** to `~/.gemini/` for:
- Temporary files: `~/.gemini/tmp/<hash>/`
- Logger initialization
- Chat recording service
- Session state

**Important:** Do NOT use `:ro` (read-only) mounts with `~/.gemini`. This causes errors:
```
Error: ENOENT: no such file or directory, mkdir '/home/agent/.gemini/tmp/...'
```

## üîÑ Upgrade Instructions

### For Docker Image (Required)

```bash
# Pull the latest image
docker pull ghcr.io/brooksomics/llm-rustyolo:latest

# OR build locally
docker build -t ghcr.io/brooksomics/llm-rustyolo:latest .
```

**Required for:** Getting Gemini CLI installed in the container

### For Rust CLI (Optional but Recommended)

```bash
# Update via Homebrew
brew upgrade rustyolo

# OR build from source
cargo build --release
cp target/release/rustyolo /usr/local/bin/
```

**Required for:** Automatic Gemini domain whitelisting

**Can skip if:** You manually specify domains with `--allow-domains`

## üÜï What's New Summary

| Feature | Status |
|---------|--------|
| Gemini CLI in Docker | ‚úÖ Added |
| Auto-whitelist Gemini domains | ‚úÖ Added |
| API key authentication | ‚úÖ Supported |
| OAuth authentication | ‚úÖ Supported |
| Pre-auth workflow docs | ‚úÖ Documented |
| Troubleshooting guide | ‚úÖ Added |

## ‚öôÔ∏è Configuration Examples

### Quick Start (API Key)
```bash
rustyolo gemini
```

### OAuth with Volume Mount
```bash
rustyolo -v ~/.gemini:/home/agent/.gemini gemini
```

### OAuth with Config File
Create `.rustyolo.toml`:
```toml
[default]
volumes = [
    "~/.gemini:/home/agent/.gemini"
]
```

Then just run:
```bash
rustyolo gemini
```

### Gemini + GitHub Access
```bash
rustyolo \
  --allow-domains "github.com api.github.com" \
  -v ~/.gemini:/home/agent/.gemini \
  -v ~/.ssh:/home/agent/.ssh:ro \
  gemini
```

## üêõ Known Issues

None at this time.

## üìù Breaking Changes

None - this release is fully backwards compatible.

## üôè Acknowledgments

- Google Gemini CLI team for the official CLI tool
- Testing and validation of OAuth workflow in sandboxed environments
- Documentation improvements based on real-world usage

## üì¶ Install

### Homebrew
```bash
brew tap brooksomics/rustyolo
brew install rustyolo
docker pull ghcr.io/brooksomics/llm-rustyolo:latest
```

### From Source
```bash
git clone https://github.com/brooksomics/llm-rustyolo.git
cd llm-rustyolo
cargo build --release
docker build -t ghcr.io/brooksomics/llm-rustyolo:latest .
```

---

**Full Changelog:** https://github.com/brooksomics/llm-rustyolo/compare/v0.5.0...v0.6.0
